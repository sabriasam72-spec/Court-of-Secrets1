<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, set, get, update, onValue, push, remove, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
  const firebaseConfig = {
    apiKey: "AIzaSyBgU6wo7DGh5xutuDAPyAvTf2hpx0PtSBU",
    authDomain: "court-of-secrets-62648.firebaseapp.com",
    databaseURL: "https://court-of-secrets-62648-default-rtdb.firebaseio.com",
    projectId: "court-of-secrets-62648",
    storageBucket: "court-of-secrets-62648.firebasestorage.app",
    messagingSenderId: "757459135639",
    appId: "1:757459135639:web:7f8ec04cfa1050b0398dd2",
    measurementId: "G-G48Z77WPEG"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  window._fb = { db, ref, set, get, update, onValue, push, remove, serverTimestamp };
  window._fbReady = true;
  document.dispatchEvent(new Event('firebase-ready'));
</script>
<style>
:root{
  --g:#c9a84c;--gl:#e8c97a;
  --d:#080810;--d2:#0f0f1a;--d3:#161622;--d4:#1e1e2c;--d5:#252535;
  --r:#7a1515;--rl:#c0392b;
  --t:#ede5d5;--td:#7a7060;
  --gr:#15503a;--grl:#27ae60;
  --bl:#152a50;--bll:#2980b9;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--d);color:var(--t);font-family:'Cairo',sans-serif;min-height:100vh;overflow-x:hidden;}
.bgfx{position:fixed;inset:0;background:radial-gradient(ellipse 80% 60% at 10% 10%,rgba(201,168,76,.06) 0%,transparent 70%),radial-gradient(ellipse 80% 60% at 90% 90%,rgba(139,26,26,.1) 0%,transparent 70%),repeating-linear-gradient(0deg,transparent,transparent 80px,rgba(201,168,76,.015) 80px,rgba(201,168,76,.015) 81px),repeating-linear-gradient(90deg,transparent,transparent 80px,rgba(201,168,76,.015) 80px,rgba(201,168,76,.015) 81px);pointer-events:none;z-index:0;}
.screen{display:none;position:relative;z-index:1;flex-direction:column;}
.screen.active{display:flex;}

/* BUTTONS */
.btn{padding:13px 26px;border:none;border-radius:6px;font-family:'Cairo',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .22s;position:relative;overflow:hidden;letter-spacing:.4px;}
.btn:hover{transform:translateY(-2px);}
.btn:active{transform:translateY(0);}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important;}
.btn-g{background:linear-gradient(135deg,#d4a84c,#9a7228);color:#06060c;box-shadow:0 4px 18px rgba(201,168,76,.28);}
.btn-g:hover{box-shadow:0 6px 28px rgba(201,168,76,.45);}
.btn-o{background:transparent;color:var(--g);border:2px solid var(--g);}
.btn-o:hover{background:rgba(201,168,76,.1);}
.btn-r{background:linear-gradient(135deg,#c0392b,#7a1515);color:#fff;}
.btn-gr{background:linear-gradient(135deg,#27ae60,#145c30);color:#fff;}
.btn-gh{background:rgba(255,255,255,.05);color:var(--td);border:1px solid rgba(255,255,255,.1);}
.btn-gh:hover{color:var(--t);}
.btn-sm{padding:8px 16px;font-size:14px;}
.btn-xs{padding:5px 11px;font-size:12px;border-radius:4px;}

/* INPUTS */
.inp{width:100%;padding:12px 14px;background:var(--d4);border:1px solid rgba(201,168,76,.25);border-radius:6px;color:var(--t);font-family:'Cairo',sans-serif;font-size:15px;outline:none;transition:border-color .22s;text-align:right;}
.inp:focus{border-color:var(--g);}
.inp::placeholder{color:var(--td);}
select.inp{cursor:pointer;appearance:none;}
textarea.inp{resize:vertical;}
.fld{margin-bottom:13px;}
.fld label{display:block;font-size:13px;color:var(--td);margin-bottom:5px;}

/* PANEL */
.panel{background:var(--d3);border:1px solid rgba(201,168,76,.18);border-radius:10px;padding:20px;}
.ptitle{font-size:16px;font-weight:700;color:var(--g);margin-bottom:12px;display:flex;align-items:center;gap:7px;}

/* DIVIDER */
.div{width:180px;height:1px;background:linear-gradient(90deg,transparent,var(--g),transparent);margin:16px auto;}

/* TOAST */
#toasts{position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none;}
.toast{background:var(--d3);border:1px solid rgba(201,168,76,.4);border-radius:8px;padding:10px 20px;font-size:14px;font-weight:600;color:var(--gl);animation:fin .3s ease;text-align:center;max-width:320px;box-shadow:0 6px 22px rgba(0,0,0,.5);}
.toast.err{border-color:rgba(192,57,43,.6);color:#e74c3c;}
.toast.ok{border-color:rgba(39,174,96,.6);color:#2ecc71;}
@keyframes fin{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}

/* MODAL */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:800;align-items:center;justify-content:center;padding:20px;}
.mo.show{display:flex;}
.mbox{background:var(--d2);border:1px solid rgba(201,168,76,.25);border-top:3px solid var(--g);border-radius:10px;padding:24px;max-width:460px;width:100%;animation:fin .3s ease;max-height:85vh;overflow-y:auto;}
.mtitle{font-family:'Amiri',serif;font-size:21px;color:var(--g);margin-bottom:14px;}

/* TOPNAV */
.tnav{display:flex;align-items:center;justify-content:space-between;padding:13px 22px;background:var(--d2);border-bottom:1px solid rgba(201,168,76,.14);position:sticky;top:0;z-index:100;}
.nlogo{font-family:'Amiri',serif;font-size:19px;color:var(--g);cursor:pointer;}

/* CONN */
.cbadge{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--td);padding:4px 10px;background:var(--d4);border-radius:20px;}
.cdot{width:8px;height:8px;border-radius:50%;background:var(--td);}
.cdot.on{background:var(--grl);}
.cdot.off{background:var(--rl);}

/* ===== HOME ===== */
#home-screen{min-height:100vh;align-items:center;justify-content:center;padding:40px 20px;}
.hero{text-align:center;animation:fdn .9s ease;}
@keyframes fdn{from{opacity:0;transform:translateY(-22px);}to{opacity:1;transform:translateY(0);}}
.hgav{font-size:88px;display:block;margin-bottom:14px;filter:drop-shadow(0 0 22px rgba(201,168,76,.55));animation:gp 3s ease infinite;}
@keyframes gp{0%,100%{filter:drop-shadow(0 0 22px rgba(201,168,76,.55));}50%{filter:drop-shadow(0 0 44px rgba(201,168,76,.9));}}
.hero h1{font-family:'Amiri',serif;font-size:clamp(44px,9vw,78px);color:var(--g);letter-spacing:2px;text-shadow:0 0 34px rgba(201,168,76,.4);}
.hero .sub{color:var(--td);font-size:14px;letter-spacing:5px;text-transform:uppercase;margin-top:6px;}
.hero .tag{color:var(--td);font-size:15px;margin-top:10px;line-height:1.7;}
.hbtns{display:flex;flex-direction:column;gap:13px;width:100%;max-width:340px;margin:30px auto 0;}
.hnav{display:flex;gap:9px;justify-content:center;margin-top:14px;}
.dcred{margin-top:38px;text-align:center;color:var(--td);font-size:12px;letter-spacing:1px;}
.dcred a{color:var(--g);text-decoration:none;font-weight:700;}
.dcred a:hover{text-decoration:underline;}
.dname{color:var(--gl);font-weight:700;}

/* ===== ABOUT ===== */
#about-screen{min-height:100vh;}
.abody{max-width:760px;margin:0 auto;padding:36px 22px;}
.ahero{text-align:center;padding:44px 20px 28px;background:linear-gradient(180deg,rgba(201,168,76,.07) 0%,transparent 100%);border-bottom:1px solid rgba(201,168,76,.14);margin-bottom:28px;}
.ahero .abig{font-size:62px;display:block;margin-bottom:9px;}
.ahero h2{font-family:'Amiri',serif;font-size:36px;color:var(--g);}
.ahero p{color:var(--td);font-size:15px;margin-top:7px;}
.asec{margin-bottom:26px;}
.asec h3{font-size:17px;color:var(--g);font-weight:700;margin-bottom:12px;padding-bottom:7px;border-bottom:1px solid rgba(201,168,76,.18);display:flex;align-items:center;gap:7px;}
.asec p{color:var(--td);font-size:15px;line-height:1.85;}
.rgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:10px;margin-top:4px;}
.rcard{background:var(--d4);border-radius:8px;padding:14px;border-right:3px solid var(--g);}
.rcard .ri{font-size:26px;margin-bottom:5px;}
.rcard .rn{font-weight:700;font-size:14px;}
.rcard .rd{font-size:12px;color:var(--td);margin-top:3px;line-height:1.5;}
.plist{display:flex;flex-direction:column;gap:9px;}
.pi{display:flex;align-items:flex-start;gap:12px;padding:12px;background:var(--d4);border-radius:8px;}
.pnum{width:30px;height:30px;border-radius:50%;background:var(--g);color:var(--d);font-weight:900;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.pinfo .pt{font-weight:700;font-size:14px;}
.pinfo .pd{font-size:12px;color:var(--td);margin-top:2px;}
.devbox{background:var(--d3);border:1px solid rgba(201,168,76,.22);border-radius:10px;padding:22px;text-align:center;margin-top:28px;}
.devbox .dav{font-size:50px;margin-bottom:8px;}
.devbox .dn{font-family:'Amiri',serif;font-size:22px;color:var(--g);}
.devbox .dt{color:var(--td);font-size:12px;margin-top:3px;}
.devbox .dlink{display:inline-block;margin-top:11px;color:var(--g);font-weight:700;font-size:13px;text-decoration:none;border:1px solid rgba(201,168,76,.4);padding:7px 18px;border-radius:20px;transition:.2s;}
.devbox .dlink:hover{background:rgba(201,168,76,.1);}

/* ===== SETTINGS ===== */
#settings-screen{min-height:100vh;}
.sbody{max-width:580px;margin:0 auto;padding:36px 22px;}
.sbody h2{font-family:'Amiri',serif;font-size:28px;color:var(--g);margin-bottom:22px;text-align:center;}
.srow{display:flex;align-items:center;justify-content:space-between;padding:14px;background:var(--d4);border-radius:8px;margin-bottom:9px;border:1px solid rgba(201,168,76,.1);}
.sinfo .sl{font-weight:700;font-size:14px;}
.sinfo .sd{font-size:12px;color:var(--td);margin-top:2px;}
.stitle{color:var(--td);font-size:11px;letter-spacing:3px;text-transform:uppercase;margin:18px 0 7px;padding-bottom:5px;border-bottom:1px solid rgba(201,168,76,.1);}
.tog{width:46px;height:24px;position:relative;cursor:pointer;}
.tog input{display:none;}
.tbg{position:absolute;inset:0;background:var(--d5);border-radius:12px;transition:.28s;border:1px solid rgba(255,255,255,.08);}
.tog input:checked+.tbg{background:var(--g);}
.tdot{position:absolute;top:3px;right:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:.28s;box-shadow:0 1px 4px rgba(0,0,0,.4);}
.tog input:checked~.tdot{right:25px;}

/* ===== LOBBY ===== */
#lobby-screen{min-height:100vh;}
.lbody{max-width:840px;margin:0 auto;padding:26px 18px;}
.lhrow{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:22px;flex-wrap:wrap;gap:13px;}
.ltitle{font-family:'Amiri',serif;font-size:25px;color:var(--g);}
.lsub{color:var(--td);font-size:13px;margin-top:3px;}
.cbox{background:var(--d3);border:2px solid var(--g);border-radius:10px;padding:12px 24px;text-align:center;}
.cbox .cl{font-size:10px;color:var(--td);letter-spacing:2px;text-transform:uppercase;}
.cbox .cv{font-family:'Amiri',serif;font-size:34px;color:var(--g);letter-spacing:8px;font-weight:700;display:block;margin:3px 0;}
.pgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(165px,1fr));gap:11px;margin-bottom:20px;}
.pcard{background:var(--d4);border:1px solid rgba(201,168,76,.17);border-radius:10px;padding:16px;text-align:center;transition:.28s;animation:faI .4s ease;}
.pcard.hst{border-color:var(--g);}
.pcard.rdy{border-color:var(--grl);background:rgba(39,174,96,.05);}
.pcard.me{box-shadow:0 0 0 2px rgba(201,168,76,.3);}
.pcav{font-size:36px;display:block;margin-bottom:7px;}
.pcn{font-weight:700;font-size:13px;}
.pcr{font-size:11px;padding:3px 9px;border-radius:20px;display:inline-block;margin-top:4px;}
.rj{background:rgba(201,168,76,.18);color:var(--g);}
.rp{background:rgba(192,57,43,.18);color:#e74c3c;}
.rd{background:rgba(41,128,185,.18);color:#3498db;}
.ri2{background:rgba(155,89,182,.18);color:#9b59b6;}
.rw{background:rgba(26,188,156,.18);color:#1abc9c;}
.ru{background:rgba(127,140,141,.18);color:#95a5a6;}

/* ===== GAME ===== */
#game-screen{min-height:100vh;}
.gtop{background:var(--d2);border-bottom:2px solid rgba(201,168,76,.2);padding:9px 16px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:7px;position:sticky;top:0;z-index:50;}
.pbadge{background:var(--d3);border:1px solid var(--g);border-radius:5px;padding:5px 14px;font-weight:700;color:var(--g);font-size:13px;}
.timer{background:var(--d3);border:2px solid var(--rl);border-radius:6px;padding:5px 16px;font-family:monospace;font-size:21px;font-weight:700;color:var(--rl);min-width:72px;text-align:center;}
.timer.warn{border-color:#e67e22;color:#e67e22;animation:blk 1s ease infinite;}
@keyframes blk{0%,100%{opacity:1;}50%{opacity:.4;}}
.mrpill{display:flex;align-items:center;gap:6px;background:var(--d3);border-radius:20px;padding:5px 14px;font-size:12px;font-weight:700;border:1px solid rgba(201,168,76,.18);}
.glayout{display:grid;grid-template-columns:250px 1fr;height:calc(100vh - 56px);}
.gsidebar{background:var(--d2);border-left:1px solid rgba(201,168,76,.13);overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:12px;}
.gmain{overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:16px;}
.stit{font-size:13px;font-weight:700;color:var(--g);display:flex;align-items:center;gap:6px;margin-bottom:8px;padding-bottom:5px;border-bottom:1px solid rgba(201,168,76,.13);}

/* Case */
.ccase{background:linear-gradient(135deg,var(--d3),var(--d4));border:1px solid rgba(201,168,76,.23);border-radius:10px;padding:16px;border-top:3px solid var(--g);}
.cnum{font-size:11px;color:var(--td);letter-spacing:3px;}
.ctitle{font-family:'Amiri',serif;font-size:24px;color:var(--g);margin:3px 0;}
.cdesc{color:var(--td);font-size:14px;line-height:1.8;}

/* Suspects */
.susgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(148px,1fr));gap:9px;}
.scard{background:var(--d4);border:1px solid rgba(192,57,43,.23);border-radius:8px;padding:13px;text-align:center;}
.sav{font-size:36px;display:block;margin-bottom:5px;}
.sn{font-weight:700;font-size:13px;}
.sr2{font-size:11px;color:var(--td);margin-top:2px;}
.sm{font-size:10px;color:#e67e22;margin-top:3px;}

/* Evidence */
.evgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:9px;}
.ecard{background:var(--d4);border:1px solid rgba(201,168,76,.11);border-radius:8px;padding:13px;cursor:pointer;transition:.22s;}
.ecard:hover{border-color:var(--g);background:rgba(201,168,76,.05);transform:translateY(-2px);}
.ecard.lk{opacity:.44;cursor:default;}
.ecard.lk:hover{transform:none;border-color:rgba(201,168,76,.11);background:var(--d4);}
.eico{font-size:24px;margin-bottom:6px;}
.enm{font-weight:700;font-size:13px;color:var(--gl);}
.edc{font-size:12px;color:var(--td);margin-top:3px;line-height:1.5;}

/* Questions */
.qitem{background:var(--d4);border:1px solid rgba(201,168,76,.11);border-radius:7px;padding:11px;margin-bottom:7px;animation:faI .3s ease;}
.qhd{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;}
.qak{font-size:12px;font-weight:700;color:var(--g);}
.qtg{font-size:11px;color:var(--td);}
.qtxt{font-size:13px;margin-bottom:6px;}
.qans{background:rgba(39,174,96,.09);border:1px solid rgba(39,174,96,.22);border-radius:4px;padding:7px;font-size:12px;color:#2ecc71;}
.qpend{color:var(--td);font-style:italic;font-size:11px;}

/* Args */
.aitem{background:var(--d4);border:1px solid rgba(201,168,76,.11);border-radius:8px;padding:13px;margin-bottom:9px;animation:faI .3s ease;}

/* Vote */
.vbox{background:var(--d3);border:2px solid var(--g);border-radius:10px;padding:20px;text-align:center;}
.vtitle{font-family:'Amiri',serif;font-size:21px;color:var(--g);margin-bottom:14px;}
.vopts{display:grid;grid-template-columns:1fr 1fr;gap:11px;max-width:270px;margin:0 auto 14px;}
.vbtn{padding:14px;background:var(--d4);border:2px solid rgba(201,168,76,.2);border-radius:8px;cursor:pointer;transition:.22s;font-family:'Cairo',sans-serif;color:var(--t);font-size:14px;font-weight:700;}
.vbtn:hover{border-color:var(--g);background:rgba(201,168,76,.1);}
.vbtn.sel{border-color:var(--g);background:rgba(201,168,76,.17);color:var(--g);}

/* Chat */
.chatwrap{display:flex;flex-direction:column;}
.chatmsgs{height:190px;overflow-y:auto;padding:9px;background:var(--d4);border:1px solid rgba(201,168,76,.13);border-radius:8px 8px 0 0;border-bottom:none;}
.cmsg{margin-bottom:8px;animation:faI .2s ease;}
.cmsg.sys .ct{background:rgba(201,168,76,.08);color:var(--gl);text-align:center;font-style:italic;border:1px solid rgba(201,168,76,.17);}
.ch{display:flex;align-items:center;gap:5px;margin-bottom:2px;}
.cn{font-weight:700;font-size:11px;}
.ct{font-size:12px;color:var(--td);padding:6px 9px;background:var(--d3);border-radius:4px;line-height:1.5;}
.chatbar{display:flex;gap:6px;padding:7px;background:var(--d3);border:1px solid rgba(201,168,76,.13);border-radius:0 0 8px 8px;}
.chatinp{flex:1;padding:7px 11px;background:var(--d4);border:1px solid rgba(201,168,76,.22);border-radius:5px;color:var(--t);font-family:'Cairo',sans-serif;font-size:13px;outline:none;text-align:right;}
.chatinp:focus{border-color:var(--g);}

/* Sidebar */
.spitem{display:flex;align-items:center;gap:7px;padding:6px 9px;background:var(--d3);border-radius:6px;border:1px solid rgba(201,168,76,.07);margin-bottom:5px;}
.spav{font-size:17px;}
.spi{flex:1;}
.spn{font-size:12px;font-weight:600;}
.spr{font-size:10px;color:var(--td);}
.sps{font-weight:700;color:var(--g);font-size:12px;}

/* Notif */
.notif{background:var(--d4);border-right:3px solid var(--g);padding:7px 11px;border-radius:4px;font-size:11px;color:var(--td);margin-bottom:5px;animation:faI .3s ease;}
.notif.err{border-right-color:var(--rl);color:#e74c3c;}
.notif.ok{border-right-color:var(--grl);color:#2ecc71;}

/* Phase sections */
.ps{display:none;}
.ps.on{display:block;}

/* Can act */
.cact{border:1px solid var(--grl)!important;animation:ga 2s ease infinite;}
@keyframes ga{0%,100%{box-shadow:0 0 8px rgba(39,174,96,.18);}50%{box-shadow:0 0 20px rgba(39,174,96,.45);}}

/* ===== RESULTS ===== */
#results-screen{min-height:100vh;align-items:center;justify-content:center;padding:40px 20px;}
.rwrap{max-width:660px;width:100%;text-align:center;}
.rtitle{font-family:'Amiri',serif;font-size:clamp(32px,6vw,56px);color:var(--g);margin-bottom:7px;}
.verdict{padding:16px 32px;border-radius:8px;font-size:21px;font-weight:900;letter-spacing:2px;margin:16px 0;}
.vg{background:var(--r);color:#fff;border:2px solid var(--rl);}
.vi{background:var(--gr);color:#fff;border:2px solid var(--grl);}
.stbl{width:100%;border-collapse:collapse;margin:14px 0;}
.stbl th{background:var(--d3);color:var(--g);padding:10px 13px;text-align:right;border:1px solid rgba(201,168,76,.17);}
.stbl td{padding:8px 13px;border:1px solid rgba(201,168,76,.08);font-size:13px;}
.stbl tr:nth-child(even) td{background:var(--d3);}
.stbl tr:first-child td{background:rgba(201,168,76,.09);color:var(--g);font-weight:700;}
.awards{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:9px;margin:14px 0;}
.awd{background:var(--d3);border:1px solid rgba(201,168,76,.19);border-radius:8px;padding:12px;text-align:center;}
.aico{font-size:24px;margin-bottom:5px;}
.albl{font-size:10px;font-weight:700;letter-spacing:1px;}
.awn{font-size:12px;margin-top:3px;}

@keyframes faI{from{opacity:0;transform:translateY(7px);}to{opacity:1;transform:translateY(0);}}
@media(max-width:680px){.glayout{grid-template-columns:1fr;grid-template-rows:auto 1fr;}.gsidebar{max-height:150px;overflow-x:auto;flex-direction:row;border-left:none;border-bottom:1px solid rgba(201,168,76,.13);}}
</style>
</head>
<body>
<div class="bgfx"></div>
<div id="toasts"></div>

<!-- ========== HOME ========== -->
<div id="home-screen" class="screen active">
  <div class="hero">
    <span class="hgav">âš–ï¸</span>
    <h1>Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±</h1>
    <p class="sub">Court of Mysteries</p>
    <div class="div"></div>
    <p class="tag">Ù„Ø¹Ø¨Ø© ØªØ­Ù‚ÙŠÙ‚ Ø¬Ù…Ø§Ø¹ÙŠØ© ØªÙ†Ø§ÙØ³ÙŠØ© Â· Ù…Ù† 3 Ø¥Ù„Ù‰ 8 Ù„Ø§Ø¹Ø¨ÙŠÙ†<br>ÙÙƒÙ‘Ø±ØŒ Ø­Ù„Ù‘Ù„ØŒ Ø§Ù‚Ù†Ø¹ØŒ ÙˆØ£ØµØ¯Ø± Ø§Ù„Ø­ÙƒÙ…</p>
  </div>
  <div class="hbtns">
    <button class="btn btn-g" onclick="openModal('cmo')">ğŸ›ï¸ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <button class="btn btn-o" onclick="openModal('jmo')">ğŸšª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</button>
  </div>
  <div class="hnav">
    <button class="btn btn-gh btn-sm" onclick="showScreen('about-screen')">ğŸ“– Ø¹Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    <button class="btn btn-gh btn-sm" onclick="showScreen('settings-screen')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>
  <div class="dcred">
    Ø·ÙÙˆÙÙ‘Ø±Øª Ø¨ÙˆØ§Ø³Ø·Ø© <span class="dname">Abu Essam</span> &nbsp;Â·&nbsp;
    <a href="https://guns.lol/sabrialharbi" target="_blank">ğŸ”— guns.lol/sabrialharbi</a>
  </div>
</div>

<!-- ========== ABOUT ========== -->
<div id="about-screen" class="screen">
  <div class="tnav">
    <span class="nlogo">âš–ï¸ Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±</span>
    <button class="btn btn-gh btn-xs" onclick="showScreen('home-screen')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>
  <div class="abody">
    <div class="ahero">
      <span class="abig">ğŸ›ï¸</span>
      <h2>Ø¹Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
      <p>Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙƒÙ… ÙˆØ§Ù„ØªØ­Ù‚ÙŠÙ‚Ø§Øª â€” ÙÙŠ Ø¬Ù„Ø³Ø© Ù…Ø´ÙˆÙ‘Ù‚Ø© ÙˆØ§Ø­Ø¯Ø©</p>
    </div>
    <div class="asec">
      <h3>ğŸ® ÙÙƒØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
      <p>Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø± Ù„Ø¹Ø¨Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ© ØªØ­Ø§ÙƒÙŠ Ø£Ø¬ÙˆØ§Ø¡ Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©. ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø© ØªÙØ¹Ø±Ø¶ Ù‚Ø¶ÙŠØ© ØºØ§Ù…Ø¶Ø© Ù…Ø¹ Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡Ù… ÙˆØ£Ø¯Ù„Ø© Ù…ØªÙ†Ø§Ø«Ø±Ø© â€” Ø¨Ø¹Ø¶Ù‡Ø§ ØµØ§Ø¯Ù‚ ÙˆØ¨Ø¹Ø¶Ù‡Ø§ Ù…Ø¶Ù„Ù„. ÙŠØ£Ø®Ø° ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ø¯ÙˆØ±Ø§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹ ÙˆÙŠØ±Ù‰ ÙÙ‚Ø· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù…Ù‡Ø§Ù…Ù‡ØŒ Ø«Ù… ØªØ¨Ø¯Ø£ Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø¥Ù‚Ù†Ø§Ø¹ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„.</p>
    </div>
    <div class="asec">
      <h3>ğŸ‘¥ Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
      <div class="rgrid">
        <div class="rcard"><div class="ri">ğŸ‘¨â€âš–ï¸</div><div class="rn">Ø§Ù„Ù‚Ø§Ø¶ÙŠ</div><div class="rd">ÙŠØ¯ÙŠØ± Ø§Ù„Ø¬Ù„Ø³Ø© ÙˆÙŠØ·Ø±Ø­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. ÙŠØ±Ù‰ Ø£Ø¯Ù„Ø© Ù…ÙˆØ³Ù‘Ø¹Ø©.</div></div>
        <div class="rcard" style="border-color:#e74c3c"><div class="ri">âš–ï¸</div><div class="rn">Ù…Ø­Ø§Ù…ÙŠ Ø§Ù„Ø§ØªÙ‡Ø§Ù…</div><div class="rd">ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…ÙØ¯ÙŠÙ†Ø© ÙˆÙŠÙ‚Ø¯Ù… Ù…Ø±Ø§ÙØ¹Ø© Ù‚ÙˆÙŠØ©.</div></div>
        <div class="rcard" style="border-color:#3498db"><div class="ri">ğŸ›¡ï¸</div><div class="rn">Ù…Ø­Ø§Ù…ÙŠ Ø§Ù„Ø¯ÙØ§Ø¹</div><div class="rd">ÙŠÙƒØ´Ù Ø§Ù„Ø«ØºØ±Ø§Øª ÙˆÙŠØ¯Ø§ÙØ¹ Ø¹Ù† Ø§Ù„Ù…ØªÙ‡Ù….</div></div>
        <div class="rcard" style="border-color:#9b59b6"><div class="ri">ğŸ•µï¸</div><div class="rn">Ø§Ù„Ù…Ø­Ù‚Ù‚</div><div class="rd">ÙŠÙ…Ù„Ùƒ Ø£Ø¯Ù„Ø© ØªÙ‚Ù†ÙŠØ© Ø­ØµØ±ÙŠØ© ÙˆÙŠØ¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.</div></div>
        <div class="rcard" style="border-color:#1abc9c"><div class="ri">ğŸ‘ï¸</div><div class="rn">Ø§Ù„Ø´Ø§Ù‡Ø¯</div><div class="rd">Ø´Ù‡Ø¯ Ø£Ø­Ø¯Ø§Ø«Ø§Ù‹ Ù…Ù‡Ù…Ø© ÙˆÙŠØ¬ÙŠØ¨ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ù…Ø§ ÙŠØ¹Ø±ÙÙ‡.</div></div>
        <div class="rcard" style="border-color:#95a5a6"><div class="ri">ğŸ—³ï¸</div><div class="rn">Ø§Ù„Ù…Ø­Ù„Ù</div><div class="rd">ÙŠØ³ØªÙ…Ø¹ Ù„Ù„Ø­Ø¬Ø¬ Ø«Ù… ÙŠÙØµØ¯Ø± Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</div></div>
      </div>
    </div>
    <div class="asec">
      <h3>ğŸ§© Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
      <div class="plist">
        <div class="pi"><div class="pnum">1</div><div class="pinfo"><div class="pt">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</div><div class="pd">ØªÙ‚Ø±Ø£ Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ø¯ÙˆØ±Ùƒ â€” Ø¯Ù‚ÙŠÙ‚ØªØ§Ù†</div></div></div>
        <div class="pi"><div class="pnum">2</div><div class="pinfo"><div class="pt">Ø§Ù„Ø§Ø³ØªØ¬ÙˆØ§Ø¨</div><div class="pd">Ø£Ø³Ø¦Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡ÙˆØ¯ ÙˆØ§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡Ù… â€” 3 Ø¯Ù‚Ø§Ø¦Ù‚</div></div></div>
        <div class="pi"><div class="pnum">3</div><div class="pinfo"><div class="pt">Ø§Ù„Ù…Ø±Ø§ÙØ¹Ø§Øª Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©</div><div class="pd">Ø§Ù„Ù…Ø­Ø§Ù…ÙˆÙ† ÙŠÙ‚Ø¯Ù…ÙˆÙ† Ø­Ø¬Ø¬Ù‡Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø© â€” Ø¯Ù‚ÙŠÙ‚ØªØ§Ù†</div></div></div>
        <div class="pi"><div class="pnum">4</div><div class="pinfo"><div class="pt">Ø§Ù„ØªØµÙˆÙŠØª</div><div class="pd">Ø§Ù„Ù…Ø­Ù„ÙÙˆÙ† ÙŠØµÙˆÙ‘ØªÙˆÙ†: Ù…Ø°Ù†Ø¨ Ø£Ù… Ø¨Ø±ÙŠØ¡ØŸ â€” Ø¯Ù‚ÙŠÙ‚Ø©</div></div></div>
        <div class="pi"><div class="pnum">5</div><div class="pinfo"><div class="pt">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div><div class="pd">ÙŠÙÙƒØ´Ù Ø§Ù„Ù…Ø¬Ø±Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØªÙÙˆØ²ÙÙ‘Ø¹ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</div></div></div>
      </div>
    </div>
    <div class="asec">
      <h3>ğŸ† Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
      <p>ØªÙƒØ³Ø¨ Ù†Ù‚Ø§Ø·Ø§Ù‹ Ø¹Ù†Ø¯ Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„ Ø°ÙƒÙŠ (+5)ØŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (+10)ØŒ ØªÙ‚Ø¯ÙŠÙ… Ù…Ø±Ø§ÙØ¹Ø© Ù…Ù‚Ù†Ø¹Ø© (+20)ØŒ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„ØµØ­ÙŠØ­ (+30). ØªÙØ¹Ù„Ù† ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø£Ù„Ù‚Ø§Ø¨: Ø¨Ø·Ù„ Ø§Ù„Ù‚Ø¶ÙŠØ©ØŒ Ø£Ø°ÙƒÙ‰ Ù…Ø­Ù„Ù„ØŒ ÙˆØ£ÙØ¶Ù„ Ù…Ø­Ø§Ù…Ù.</p>
    </div>
    <div class="devbox">
      <div class="dav">ğŸ‘¨â€ğŸ’»</div>
      <div class="dn">Abu Essam</div>
      <div class="dt">Ù…Ø·ÙˆÙ‘Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©</div>
      <a class="dlink" href="https://guns.lol/sabrialharbi" target="_blank">ğŸ”— guns.lol/sabrialharbi</a>
    </div>
    <div style="text-align:center;margin-top:22px;">
      <button class="btn btn-o" onclick="showScreen('home-screen')">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  </div>
</div>

<!-- ========== SETTINGS ========== -->
<div id="settings-screen" class="screen">
  <div class="tnav">
    <span class="nlogo">âš–ï¸ Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±</span>
    <button class="btn btn-gh btn-xs" onclick="showScreen('home-screen')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>
  <div class="sbody">
    <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
    <div class="stitle">Ø§Ù„ØµÙˆØª</div>
    <div class="srow"><div class="sinfo"><div class="sl">ğŸ”Š Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</div><div class="sd">ØµÙˆØª Ø§Ù„Ù…Ø·Ø±Ù‚Ø© ÙˆØ§Ù„Ø£Ø¬ÙˆØ§Ø¡</div></div><label class="tog"><input type="checkbox" id="s-snd" checked onchange="sv('sound',this.checked)"><div class="tbg"></div><div class="tdot"></div></label></div>
    <div class="srow"><div class="sinfo"><div class="sl">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©</div><div class="sd">Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØªÙˆØªØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨</div></div><label class="tog"><input type="checkbox" id="s-music" onchange="sv('music',this.checked)"><div class="tbg"></div><div class="tdot"></div></label></div>
    <div class="stitle">Ø§Ù„Ù„Ø¹Ø¨</div>
    <div class="srow"><div class="sinfo"><div class="sl">ğŸ”” Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯ÙˆØ±</div><div class="sd">ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØµØ¨Ø­ Ø¯ÙˆØ±Ùƒ</div></div><label class="tog"><input type="checkbox" id="s-notif" checked onchange="sv('notif',this.checked)"><div class="tbg"></div><div class="tdot"></div></label></div>
    <div class="srow"><div class="sinfo"><div class="sl">â±ï¸ ØªØ­Ø°ÙŠØ± Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª</div><div class="sd">ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø¢Ø®Ø± 30 Ø«Ø§Ù†ÙŠØ©</div></div><label class="tog"><input type="checkbox" id="s-tw" checked onchange="sv('timerWarn',this.checked)"><div class="tbg"></div><div class="tdot"></div></label></div>
    <div class="stitle">Ø§Ù„Ø¹Ø±Ø¶</div>
    <div class="srow"><div class="sinfo"><div class="sl">âœ¨ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©</div><div class="sd">ØªÙØ¹ÙŠÙ„ ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ©</div></div><label class="tog"><input type="checkbox" id="s-anim" checked onchange="sv('anim',this.checked)"><div class="tbg"></div><div class="tdot"></div></label></div>
    <div class="srow"><div class="sinfo"><div class="sl">ğŸŒ™ ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ù„ÙŠ</div><div class="sd">ØªØ­Ø³ÙŠÙ† ÙˆØ¶ÙˆØ­ Ø§Ù„Ù†ØµÙˆØµ</div></div><label class="tog"><input type="checkbox" id="s-con" onchange="sv('contrast',this.checked);applyContrast()"><div class="tbg"></div><div class="tdot"></div></label></div>
    <div style="margin-top:26px;text-align:center;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
      <button class="btn btn-r btn-sm" onclick="resetSettings()">ğŸ—‘ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
      <button class="btn btn-o" onclick="showScreen('home-screen')">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  </div>
</div>

<!-- ========== MODALS ========== -->
<div id="cmo" class="mo">
  <div class="mbox">
    <div class="mtitle">ğŸ›ï¸ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</div>
    <div class="fld"><label>Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label><input class="inp" id="cn" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." maxlength="20"></div>
    <div class="fld"><label>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø¶ÙŠØ©</label>
      <select class="inp" id="csel">
        <option value="0">ğŸ›ï¸ Ù‚Ø¶ÙŠØ© Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚</option>
        <option value="1">ğŸ’ Ù…Ù‚ØªÙ„ Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ø«Ø±ÙŠ</option>
        <option value="2">ğŸ“‚ Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ©</option>
      </select>
    </div>
    <div style="display:flex;gap:9px;margin-top:4px;">
      <button class="btn btn-g" style="flex:1" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© â†’</button>
      <button class="btn btn-gh btn-sm" onclick="closeModal('cmo')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<div id="jmo" class="mo">
  <div class="mbox">
    <div class="mtitle">ğŸšª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</div>
    <div class="fld"><label>Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label><input class="inp" id="jn" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." maxlength="20"></div>
    <div class="fld"><label>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</label><input class="inp" id="jc" placeholder="Ù…Ø«Ø§Ù„: AB12CD" maxlength="6" style="text-transform:uppercase;letter-spacing:5px;font-size:20px;text-align:center;"></div>
    <div id="fbstat" class="cbadge" style="margin-bottom:11px;justify-content:center;"><div class="cdot" id="fbd"></div><span id="fbst">Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...</span></div>
    <div style="display:flex;gap:9px;">
      <button class="btn btn-gr" style="flex:1" onclick="joinRoom()">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù† â†’</button>
      <button class="btn btn-gh btn-sm" onclick="closeModal('jmo')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<div id="evmo" class="mo">
  <div class="mbox" style="max-width:400px;">
    <div id="evmc"></div>
    <button class="btn btn-gh btn-sm" style="margin-top:13px;" onclick="closeModal('evmo')">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<!-- ========== LOBBY ========== -->
<div id="lobby-screen" class="screen">
  <div class="tnav">
    <span class="nlogo">âš–ï¸ Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±</span>
    <div style="display:flex;align-items:center;gap:9px;">
      <div class="cbadge"><div class="cdot on" id="lconn"></div><span>Firebase Ù…ØªØµÙ„</span></div>
      <button class="btn btn-gh btn-xs" onclick="leaveRoom()">â†© Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
  <div class="lbody">
    <div class="lhrow">
      <div><div class="ltitle">â³ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</div><div class="lsub" id="lcaselbl"></div></div>
      <div class="cbox"><div class="cl">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div><span class="cv" id="lcode">------</span><button class="btn btn-o btn-xs" style="margin-top:5px;" onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø®</button></div>
    </div>
    <div id="lplayers" class="pgrid"></div>
    <div style="display:flex;gap:11px;flex-wrap:wrap;align-items:center;">
      <div id="hctrl" style="display:none;gap:11px;align-items:center;">
        <button class="btn btn-g" onclick="startGame()" id="sbtn">ğŸ¬ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <span style="color:var(--td);font-size:13px;" id="smsg"></span>
      </div>
      <div id="gctrl"><button class="btn btn-gr" id="rbtn" onclick="toggleReady()">âœ… Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø²</button></div>
    </div>
  </div>
</div>

<!-- ========== GAME ========== -->
<div id="game-screen" class="screen">
  <div class="gtop">
    <div style="display:flex;align-items:center;gap:9px;">
      <span class="pbadge" id="plbl">â€”</span>
      <span style="color:var(--td);font-size:11px;" id="pslbl"></span>
    </div>
    <div class="timer" id="gtimer">--:--</div>
    <div style="display:flex;align-items:center;gap:7px;flex-wrap:wrap;">
      <div class="mrpill"><span id="mrico">ğŸ‘¤</span><span id="mrn">â€”</span></div>
      <button id="habtn" class="btn btn-o btn-xs" style="display:none;" onclick="advancePhase()">â­ Ø§Ù„ØªØ§Ù„ÙŠ</button>
      <button class="btn btn-gh btn-xs" onclick="leaveRoom()">â†© Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
  <div class="glayout">
    <div class="gsidebar">
      <div class="stit">ğŸ‘¥ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</div><div id="gpl"></div>
      <div class="stit">ğŸ”” Ø£Ø­Ø¯Ø§Ø«</div><div id="gnotifs"></div>
      <div class="stit">ğŸ† Ù†Ù‚Ø§Ø·</div><div id="gscores"></div>
    </div>
    <div class="gmain">
      <div class="ccase"><div class="cnum" id="gcnum">Ø§Ù„Ù‚Ø¶ÙŠØ© #001</div><div class="ctitle" id="gctitle">â€”</div><p class="cdesc" id="gcdesc"></p></div>
      <div class="ps on" id="pssus"><div class="stit">ğŸ•µï¸ Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡Ù…</div><div class="susgrid" id="gsus"></div></div>
      <div class="ps on" id="psev"><div class="stit">ğŸ” Ø§Ù„Ø£Ø¯Ù„Ø©</div><div class="evgrid" id="gev"></div></div>
      <div class="ps" id="psiq">
        <div class="stit">â“ Ø§Ù„Ø§Ø³ØªØ¬ÙˆØ§Ø¨</div>
        <div id="askarea" style="display:none;margin-bottom:13px;">
          <div class="panel cact"><div class="ptitle">ğŸ’¬ Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„</div>
            <div class="fld"><label>Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø¥Ù„Ù‰</label><select class="inp" id="qtgt"></select></div>
            <div class="fld"><input class="inp" id="qtxt" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..."></div>
            <button class="btn btn-g btn-sm" onclick="submitQ()">Ø¥Ø±Ø³Ø§Ù„ â†</button>
          </div>
        </div>
        <div id="ansarea" style="display:none;margin-bottom:13px;"></div>
        <div id="qlist"></div>
      </div>
      <div class="ps" id="psarg">
        <div class="stit">ğŸ—£ï¸ Ø§Ù„Ù…Ø±Ø§ÙØ¹Ø§Øª Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©</div>
        <div id="arginput" style="display:none;margin-bottom:13px;">
          <div class="panel cact"><div class="ptitle">âœï¸ Ù…Ø±Ø§ÙØ¹ØªÙƒ Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©</div>
            <textarea class="inp" id="argtxt" rows="4" placeholder="Ù‚Ø¯Ù‘Ù… Ø­Ø¬ØªÙƒ Ø§Ù„Ø£Ù‚ÙˆÙ‰..."></textarea>
            <button class="btn btn-g btn-sm" style="margin-top:9px;" onclick="submitArg()">ØªÙ‚Ø¯ÙŠÙ… â†</button>
          </div>
        </div>
        <div id="argslist"></div>
      </div>
      <div class="ps" id="psvote">
        <div class="vbox">
          <div class="vtitle">ğŸ—³ï¸ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
          <p style="color:var(--td);font-size:13px;margin-bottom:12px;">Ù‡Ù„ Ø§Ù„Ù…ØªÙ‡Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø°Ù†Ø¨ØŸ</p>
          <div id="vstmsg" style="margin-bottom:9px;font-size:13px;"></div>
          <div class="vopts" id="vopts">
            <button class="vbtn" onclick="castVote('guilty')">âš–ï¸ Ù…Ø°Ù†Ø¨</button>
            <button class="vbtn" onclick="castVote('innocent')">ğŸ•Šï¸ Ø¨Ø±ÙŠØ¡</button>
          </div>
          <div id="vcntlbl" style="font-size:12px;color:var(--td);"></div>
        </div>
      </div>
      <div>
        <div class="stit">ğŸ’¬ Ù†Ù‚Ø§Ø´ Ø¹Ø§Ù…</div>
        <div class="chatwrap">
          <div class="chatmsgs" id="gchat"></div>
          <div class="chatbar">
            <button class="btn btn-g btn-xs" onclick="sendChat()">Ø¥Ø±Ø³Ø§Ù„</button>
            <input class="chatinp" id="chatinp" placeholder="Ø§ÙƒØªØ¨..." onkeydown="if(event.key==='Enter')sendChat()">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========== RESULTS ========== -->
<div id="results-screen" class="screen">
  <div class="rwrap" style="margin:0 auto;padding:40px 20px;">
    <div style="font-size:62px;text-align:center;margin-bottom:9px;animation:faI .8s ease;">âš–ï¸</div>
    <h2 class="rtitle">Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
    <div id="rverd" style="display:none;" class="verdict"></div>
    <div id="rtruth" style="margin:12px 0;color:var(--td);font-size:14px;text-align:center;"></div>
    <h3 style="color:var(--g);text-align:center;margin:16px 0 9px;font-size:16px;">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
    <table class="stbl" id="rscores"><tr><th>Ø§Ù„Ù…Ø±ÙƒØ²</th><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr></table>
    <div class="awards" id="rawards"></div>
    <div style="display:flex;gap:11px;justify-content:center;margin-top:20px;flex-wrap:wrap;">
      <button class="btn btn-g" onclick="playAgain()">ğŸ”„ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <button class="btn btn-o" onclick="goHome()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
    <div class="dcred" style="margin-top:26px;">
      Ø·ÙÙˆÙÙ‘Ø±Øª Ø¨ÙˆØ§Ø³Ø·Ø© <span class="dname">Abu Essam</span> &nbsp;Â·&nbsp;
      <a href="https://guns.lol/sabrialharbi" target="_blank">ğŸ”— guns.lol/sabrialharbi</a>
    </div>
  </div>
</div>

<script>
// â”€â”€ SETTINGS â”€â”€
let S=JSON.parse(localStorage.getItem('cs_set')||'{"sound":true,"music":false,"notif":true,"timerWarn":true,"anim":true,"contrast":false}');
function sv(k,v){S[k]=v;localStorage.setItem('cs_set',JSON.stringify(S));}
function resetSettings(){S={sound:true,music:false,notif:true,timerWarn:true,anim:true,contrast:false};localStorage.setItem('cs_set',JSON.stringify(S));loadSUI();toast('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·','ok');}
function loadSUI(){['s-snd','s-music','s-notif','s-tw','s-anim','s-con'].forEach((id,i)=>{const keys=['sound','music','notif','timerWarn','anim','contrast'];const el=document.getElementById(id);if(el)el.checked=S[keys[i]];});applyContrast();}
function applyContrast(){document.body.style.filter=S.contrast?'contrast(1.12)':'';}

// â”€â”€ UTILS â”€â”€
function uid(){return Math.random().toString(36).substr(2,9);}
function rndCode(){return Math.random().toString(36).substr(2,6).toUpperCase();}
function nowTime(){return new Date().toLocaleTimeString('ar',{hour:'2-digit',minute:'2-digit'});}
function getAv(n){const a=['ğŸ‘¨','ğŸ‘©','ğŸ‘¦','ğŸ‘§','ğŸ§‘','ğŸ‘´','ğŸ‘µ','ğŸ§”','ğŸ‘±','ğŸ§•'];return a[n.charCodeAt(0)%a.length];}
function toast(m,type='',dur=3000){const c=document.getElementById('toasts');const el=document.createElement('div');el.className='toast '+(type==='err'?'err':type==='ok'?'ok':'');el.textContent=m;c.appendChild(el);setTimeout(()=>el.remove(),dur);}
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');}
function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}
function toArr(o){if(!o)return[];if(Array.isArray(o))return o;return Object.values(o);}
function curScreen(){const s=document.querySelector('.screen.active');return s?s.id:null;}

// â”€â”€ FIREBASE â”€â”€
let FB=null,fbReady=false;
document.addEventListener('firebase-ready',()=>{
  FB=window._fb;fbReady=true;
  const d=document.getElementById('fbd');if(d)d.classList.add('on');
  const s=document.getElementById('fbst');if(s)s.textContent='Firebase Ù…ØªØµÙ„ âœ“';
});
function dbRef(p){return FB.ref(FB.db,p);}
function dbSet(p,v){return FB.set(dbRef(p),v);}
function dbUpd(p,v){return FB.update(dbRef(p),v);}
function dbGet(p){return FB.get(dbRef(p)).then(s=>s.val());}
function dbOn(p,cb){return FB.onValue(dbRef(p),s=>cb(s.val()));}
function dbPush(p,v){return FB.push(dbRef(p),v);}

// â”€â”€ STATE â”€â”€
let myId=null,myRoom=null,isHost=false,unsub=null,lastCL=0;

// â”€â”€ DATA â”€â”€
const CASES=[
  {id:0,title:"Ù‚Ø¶ÙŠØ© Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚",description:"ÙÙŠ Ù„ÙŠÙ„Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©ØŒ Ø§Ø®ØªÙØª Ù‚Ø·Ø¹Ø© Ø£Ø«Ø±ÙŠØ© Ù†Ø§Ø¯Ø±Ø© Ù…Ù† Ù…ØªØ­Ù Ø§Ù„Ø¢Ø¯Ø§Ø¨ Ø§Ù„ÙˆØ·Ù†ÙŠ. Ø¨Ø§Ø¨ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø®Ù„ÙÙŠØ© ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹ ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© Ù…ÙƒØ³ÙˆØ±Ø©. Ù„Ø§ Ø¢Ø«Ø§Ø± Ø§Ù‚ØªØ­Ø§Ù… ÙÙŠ Ø§Ù„Ù†ÙˆØ§ÙØ°. Ù…Ù† Ø³Ø±Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŸ",culprit:1,
    evidence:[
      {id:'e1',name:'Ø¨ØµÙ…Ø§Øª Ø£ØµØ§Ø¨Ø¹',type:'ğŸ”¬',desc:'Ø¨ØµÙ…Ø§Øª Ø¬Ø²Ø¦ÙŠØ© Ø¹Ù„Ù‰ Ø­Ø§ÙØ© Ø§Ù„Ø­Ø§Ù„Ø© ØªØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ù…ÙˆØ¸Ù ÙÙŠ Ø§Ù„Ù…ØªØ­Ù.',rv:['judge','prosecutor','defender','investigator']},
      {id:'e2',name:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§',type:'ğŸ“¹',desc:'Ø´Ø¨Ø­ Ø¨Ù…Ø¹Ø·Ù Ø±Ù…Ø§Ø¯ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 11 Ù…Ø³Ø§Ø¡Ù‹. Ø§Ù„ÙˆØ¬Ù‡ Ù…Ø­Ø¬ÙˆØ¨ ÙˆØ§Ù„Ø­Ø±ÙƒØ© ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø´Ø®Øµ ÙŠØ¹Ø±Ù Ø§Ù„Ù…ÙƒØ§Ù†.',rv:['judge','prosecutor','defender','investigator']},
      {id:'e3',name:'Ù…ÙØªØ§Ø­ Ù…ÙƒØ±Ø±',type:'ğŸ”‘',desc:'Ù…ÙØªØ§Ø­ Ù…ÙƒØ±Ø± ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª. Ù†ÙØ³Ø® Ù‚Ø¨Ù„ 3 Ø£Ø´Ù‡Ø± ÙˆÙÙ‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ.',rv:['judge','prosecutor']},
      {id:'e4',name:'Ø±Ø³Ø§Ù„Ø© Ù…Ø¬Ù‡ÙˆÙ„Ø©',type:'ğŸ“',desc:'"Ø§Ù„Ù…Ø§Ø¶ÙŠ Ù„Ø§ ÙŠÙØ¨Ø§Ø¹" â€” Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙŠØ´Ø¨Ù‡ Ø£Ø­Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†.',rv:['judge','prosecutor','defender']},
      {id:'e5',name:'ØªØ­ÙˆÙŠÙ„ Ù…ØµØ±ÙÙŠ',type:'ğŸ’°',desc:'50,000 Ø±ÙŠØ§Ù„ Ù…Ù† Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù‡ÙˆÙ„ Ù‚Ø¨Ù„ ÙŠÙˆÙ…ÙŠÙ† Ù…Ù† Ø§Ù„Ø³Ø±Ù‚Ø©.',rv:['prosecutor','investigator']},
      {id:'e6',name:'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ø±Ø³',type:'ğŸ‘ï¸',desc:'Ø±Ø£Ù‰ Ø¶ÙˆØ¡Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù…Ø± Ø§Ù„Ø®Ù„ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 1 ÙØ¬Ø±Ø§Ù‹.',rv:['judge','prosecutor','defender','investigator','witness']},
    ],
    suspects:[{id:0,name:'Ø¯. Ø³Ø§Ù„Ù… Ø§Ù„Ø±Ø§Ø´Ø¯',role:'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªØ­Ù',avatar:'ğŸ‘¨â€ğŸ’¼',motive:'Ù…Ø´Ø§ÙƒÙ„ Ù…Ø§Ù„ÙŠØ©'},{id:1,name:'Ù†Ø§Ø¯ÙŠØ© Ø§Ù„Ø­Ø³Ù†',role:'Ø£Ø®ØµØ§Ø¦ÙŠØ© Ø§Ù„Ø¢Ø«Ø§Ø±',avatar:'ğŸ‘©â€ğŸ”¬',motive:'Ø®Ù„Ø§Ù Ù…Ù‡Ù†ÙŠ',isCulprit:true},{id:2,name:'Ø·Ø§Ø±Ù‚ Ù…Ù†ØµÙˆØ±',role:'Ø­Ø§Ø±Ø³ Ø§Ù„Ù„ÙŠÙ„',avatar:'ğŸ‘®',motive:'ØºÙŠØ± Ù…Ø¹Ù„ÙˆÙ…'},{id:3,name:'Ù„ÙŠÙ„Ù‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',role:'Ù…Ù†Ø³Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶',avatar:'ğŸ‘©â€ğŸ¨',motive:'Ø±ÙØ¶ Ø·Ù„Ø¨ Ù†Ù‚Ù„'}]
  },
  {id:1,title:"Ù…Ù‚ØªÙ„ Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ø«Ø±ÙŠ",description:"ÙˆÙØ¬Ø¯ Ø§Ù„ØªØ§Ø¬Ø± Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ Ù…ÙŠØªØ§Ù‹ ÙÙŠ Ù…ÙƒØªØ¨Ù‡ Ø§Ù„Ù…Ù‚ÙÙ„ Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„. Ù„Ø§ Ø¢Ø«Ø§Ø± Ø¹Ù†Ù ÙˆØ§Ø¶Ø­Ø©. Ù‡Ù„ ÙƒØ§Ù† Ø§Ù†ØªØ­Ø§Ø±Ø§Ù‹ Ø£Ù… Ø¬Ø±ÙŠÙ…Ø© Ø°ÙƒÙŠØ© Ø¯Ø¨Ù‘Ø±Ù‡Ø§ Ø£Ø­Ø¯ Ø§Ù„Ù…Ù‚Ø±Ø¨ÙŠÙ†ØŸ",culprit:2,
    evidence:[
      {id:'e1',name:'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©',type:'ğŸ“‹',desc:'Ø³Ù…Ø¹Øª Ù†Ù‚Ø§Ø´Ø§Ù‹ Ø­Ø§Ø¯Ø§Ù‹ Ù‚Ø¨Ù„ Ø³Ø§Ø¹Ø© Ù…Ù† Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø¬Ø«Ø©.',rv:['judge','prosecutor','defender','investigator','witness']},
      {id:'e2',name:'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ø¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ',type:'ğŸ”¬',desc:'ØªØ³Ù…Ù… ØªØ¯Ø±ÙŠØ¬ÙŠ â€” Ø§Ù„Ø³Ù… Ø£ÙØ¶ÙŠÙ Ù„Ù„Ù‚Ù‡ÙˆØ© Ø¹Ù„Ù‰ Ù…Ø¯Ù‰ Ø£ÙŠØ§Ù….',rv:['judge','prosecutor','investigator']},
      {id:'e3',name:'Ø§Ù„ÙˆØµÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',type:'ğŸ“œ',desc:'ÙˆØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…ÙˆÙ‚Ù‘Ø¹Ø© Ù‚Ø¨Ù„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ† ØªØ³ØªØ«Ù†ÙŠ Ø§Ù„Ø§Ø¨Ù† Ù…Ù† Ø§Ù„Ø¥Ø±Ø«.',rv:['judge','prosecutor','defender']},
      {id:'e4',name:'ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…ØµØ¹Ø¯',type:'ğŸ“¹',desc:'Ø«Ù„Ø§Ø«Ø© Ø£Ø´Ø®Ø§Øµ Ø¯Ø®Ù„ÙˆØ§ Ø§Ù„Ù…ÙƒØªØ¨ ÙÙŠ Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©.',rv:['judge','prosecutor','defender','investigator']},
      {id:'e5',name:'Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§ØªØ³Ø§Ø¨',type:'ğŸ“±',desc:'Ø®Ù„Ø§Ù Ù…Ø§Ù„ÙŠ Ø­Ø§Ø¯ Ù…Ø¹ Ø§Ù„Ø§Ø¨Ù† Ù‚Ø¨Ù„ 3 Ø£ÙŠØ§Ù….',rv:['prosecutor','investigator']},
      {id:'e6',name:'Ù‚Ø§Ø±ÙˆØ±Ø© Ø³Ù…',type:'ğŸ§ª',desc:'ÙˆÙØ¬Ø¯Øª Ø®Ù„Ù ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨. Ø·Ø¨Ø¹Ø© Ø£ØµØ§Ø¨Ø¹ Ù†Ø§Ù‚ØµØ©.',rv:['judge','prosecutor','investigator']},
    ],
    suspects:[{id:0,name:'Ø®Ø§Ù„Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ',role:'Ø§Ù„Ø§Ø¨Ù†',avatar:'ğŸ‘¦',motive:'Ø§Ù„Ø¥Ø±Ø« Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚'},{id:1,name:'Ø±Ø§Ø´Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ',role:'Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ',avatar:'ğŸ‘”',motive:'ØµÙÙ‚Ø© ÙØ§Ø´Ù„Ø©'},{id:2,name:'Ù…Ù‡Ø§ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ',role:'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©',avatar:'ğŸ‘©â€ğŸ’¼',motive:'Ø§Ø®ØªÙ„Ø§Ø³ Ù…ÙƒØ´ÙˆÙ',isCulprit:true},{id:3,name:'ÙŠØ§Ø³Ø± Ø§Ù„Ø¨Ù„ÙˆÙŠ',role:'Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø®Ø§Øµ',avatar:'ğŸš—',motive:'Ø·Ø±Ø¯ Ù‚Ø±ÙŠØ¨'}]
  },
  {id:2,title:"Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ©",description:"Ù…Ù„ÙØ§Øª Ø³Ø±ÙŠØ© Ø§Ø®ØªÙØª Ù…Ù† Ø®Ø²Ù†Ø© Ø§Ù„ÙˆØ²Ø§Ø±Ø©. ÙÙ‚Ø· Ø«Ù„Ø§Ø«Ø© Ø£Ø´Ø®Ø§Øµ ÙŠØ¹Ø±ÙÙˆÙ† Ø§Ù„Ø±Ù…Ø². Ø§Ù„Ø®Ø²Ù†Ø© Ù„Ù… ØªÙÙƒØ³Ø±. Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ø®ØªÙØª Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø¤ØªÙ…Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠ. Ù…Ù† Ø¨Ø§Ø¹ Ø§Ù„Ø³Ø±ØŸ",culprit:0,
    evidence:[
      {id:'e1',name:'Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„',type:'ğŸ”',desc:'Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø³Ø§Ø¹Ø© 2:17 ÙØ¬Ø±Ø§Ù‹.',rv:['judge','prosecutor','defender','investigator']},
      {id:'e2',name:'ÙÙ†Ø¯Ù‚ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',type:'ğŸ¨',desc:'Ø­Ø¬Ø² Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ Ù„Ø£Ø­Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ ÙÙ†Ø¯Ù‚ Ø¨Ù…Ø¯ÙŠÙ†Ø© Ù…Ø¬Ø§ÙˆØ±Ø©.',rv:['prosecutor','investigator']},
      {id:'e3',name:'Ø§ØªØµØ§Ù„ Ù…Ø±ÙŠØ¨',type:'ğŸ“',desc:'Ù…ÙƒØ§Ù„Ù…Ø© 47 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø¹ Ø±Ù‚Ù… Ø¯ÙˆÙ„ÙŠ Ù…Ø¬Ù‡ÙˆÙ„ Ù‚Ø¨Ù„ 3 Ø£ÙŠØ§Ù….',rv:['judge','prosecutor','defender','investigator']},
      {id:'e4',name:'Ø´Ø±Ø§Ø¡ Ø¹Ù‚Ø§Ø±',type:'ğŸ ',desc:'Ø¯ÙØ¹Ø© Ø£ÙˆÙ„Ù‰ 800,000 Ø±ÙŠØ§Ù„ Ù‚Ø¨Ù„ Ø£Ø³Ø¨ÙˆØ¹. Ø§Ù„Ø±Ø§ØªØ¨ Ù„Ø§ ÙŠÙƒÙÙŠ.',rv:['prosecutor','investigator']},
      {id:'e5',name:'ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ø¯Ø®Ù„',type:'ğŸ“¹',desc:'Ø³ÙŠØ§Ø±Ø© Ø¨Ù„ÙˆØ­Ø© Ù…Ø³ØªØ¹Ø§Ø±Ø© ØªÙˆÙ‚ÙØª 12 Ø¯Ù‚ÙŠÙ‚Ø©.',rv:['judge','prosecutor','defender','investigator','witness']},
      {id:'e6',name:'ÙˆØ±Ù‚Ø© Ù…Ù…Ø²Ù‚Ø©',type:'ğŸ“„',desc:'Ø£Ø±Ù‚Ø§Ù… ØªØ´Ø¨Ù‡ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙÙŠ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª.',rv:['judge','prosecutor','defender']},
    ],
    suspects:[{id:0,name:'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø±ÙŠ',role:'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù…',avatar:'ğŸ‘¨â€ğŸ’»',motive:'Ø¯ÙŠÙˆÙ† ÙˆØ¶Ø§Ø¦Ù‚Ø© Ù…Ø§Ù„ÙŠØ©',isCulprit:true},{id:1,name:'Ø³Ø§Ø±Ø© Ø§Ù„ØºØ§Ù…Ø¯ÙŠ',role:'Ø³ÙƒØ±ØªÙŠØ±Ø© ØªÙ†ÙÙŠØ°ÙŠØ©',avatar:'ğŸ‘©',motive:'ØªØ±Ù‚ÙŠØ© Ù…Ø±ÙÙˆØ¶Ø©'},{id:2,name:'ÙÙŠØµÙ„ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ',role:'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø£Ù…Ù†',avatar:'ğŸ›¡ï¸',motive:'ØºÙŠØ± Ù…Ø¹Ù„ÙˆÙ…'},{id:3,name:'Ù†ÙˆÙ Ø§Ù„Ø³Ù„Ù…ÙŠ',role:'Ù…Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©',avatar:'âš–ï¸',motive:'ØªÙ†Ø§ÙØ³ Ù…Ù‡Ù†ÙŠ'}]
  }
];

const ROLES={
  judge:       {name:'Ø§Ù„Ù‚Ø§Ø¶ÙŠ',        icon:'ğŸ‘¨â€âš–ï¸',color:'#c9a84c',canAsk:true, canAns:false,canArg:false,canVote:false},
  prosecutor:  {name:'Ù…Ø­Ø§Ù…ÙŠ Ø§Ù„Ø§ØªÙ‡Ø§Ù…', icon:'âš–ï¸',  color:'#e74c3c',canAsk:true, canAns:false,canArg:true, canVote:false},
  defender:    {name:'Ù…Ø­Ø§Ù…ÙŠ Ø§Ù„Ø¯ÙØ§Ø¹',  icon:'ğŸ›¡ï¸',  color:'#3498db',canAsk:true, canAns:false,canArg:true, canVote:false},
  investigator:{name:'Ø§Ù„Ù…Ø­Ù‚Ù‚',        icon:'ğŸ•µï¸',  color:'#9b59b6',canAsk:false,canAns:true, canArg:false,canVote:false},
  witness:     {name:'Ø§Ù„Ø´Ø§Ù‡Ø¯',        icon:'ğŸ‘ï¸',  color:'#1abc9c',canAsk:false,canAns:true, canArg:false,canVote:false},
  jury:        {name:'Ø§Ù„Ù…Ø­Ù„Ù',        icon:'ğŸ—³ï¸',  color:'#95a5a6',canAsk:false,canAns:false,canArg:false,canVote:true},
};
const RORDER=['judge','prosecutor','defender','investigator','witness','jury'];
const PHASES=[
  {id:'waiting',dur:0},{id:'case_review',dur:120},{id:'interrogation',dur:180},
  {id:'arguments',dur:120},{id:'voting',dur:60},{id:'results',dur:0}
];
const PNAMES={case_review:'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©',interrogation:'Ø§Ù„Ø§Ø³ØªØ¬ÙˆØ§Ø¨',arguments:'Ø§Ù„Ù…Ø±Ø§ÙØ¹Ø§Øª Ø§Ù„Ø®ØªØ§Ù…ÙŠØ©',voting:'Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ',results:'Ø§Ù„Ù†ØªØ§Ø¦Ø¬'};
const PDESCS={case_review:'Ø§Ù‚Ø±Ø£ Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆØ§Ø³ØªÙˆØ¹Ø¨ Ø§Ù„Ù‚Ø¶ÙŠØ©',interrogation:'Ø·Ø±Ø­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø©',arguments:'Ø§Ù„Ù…Ø­Ø§Ù…ÙˆÙ† ÙŠÙ‚Ø¯Ù…ÙˆÙ† Ø­Ø¬Ø¬Ù‡Ù…',voting:'Ø§Ù„Ù…Ø­Ù„ÙÙˆÙ† ÙŠØµØ¯Ø±ÙˆÙ† Ø§Ù„Ø­ÙƒÙ…',results:''};

// â”€â”€ CREATE ROOM â”€â”€
async function createRoom(){
  if(!fbReady){toast('Firebase ØºÙŠØ± Ù…ØªØµÙ„','err');return;}
  const name=document.getElementById('cn').value.trim();
  if(!name){toast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ','err');return;}
  const ci=parseInt(document.getElementById('csel').value);
  const code=rndCode();myId=uid();myRoom=code;isHost=true;
  const me={id:myId,name,role:'judge',score:0,ready:false,avatar:getAv(name),isHost:true};
  const room={code,caseIdx:ci,phase:'waiting',phaseIdx:0,hostId:myId,phaseStart:null,players:{[myId]:me},chat:[],questions:{},arguments:{},votes:{}};
  await dbSet('rooms/'+code,room);
  closeModal('cmo');
  subscribeRoom(code);
  enterLobby(room);
}

// â”€â”€ JOIN ROOM â”€â”€
async function joinRoom(){
  if(!fbReady){toast('Firebase ØºÙŠØ± Ù…ØªØµÙ„','err');return;}
  const name=document.getElementById('jn').value.trim();
  const code=document.getElementById('jc').value.trim().toUpperCase();
  if(!name){toast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ','err');return;}
  if(!code){toast('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©','err');return;}
  const room=await dbGet('rooms/'+code);
  if(!room){toast('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©','err');return;}
  if(Object.keys(room.players||{}).length>=8){toast('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©','err');return;}
  if(room.phase!=='waiting'){toast('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„ÙØ¹Ù„','err');return;}
  const used=Object.values(room.players||{}).map(p=>p.role);
  let role='jury';for(const r of RORDER){if(!used.includes(r)){role=r;break;}}
  myId=uid();myRoom=code;isHost=false;
  const me={id:myId,name,role,score:0,ready:false,avatar:getAv(name),isHost:false};
  await dbUpd('rooms/'+code+'/players/'+myId,me);
  await dbPush('rooms/'+code+'/chat',{system:true,text:'ğŸšª Ø§Ù†Ø¶Ù… '+name+' Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø©',ts:Date.now()});
  closeModal('jmo');
  subscribeRoom(code);
  const fresh=await dbGet('rooms/'+code);
  enterLobby(fresh);
}

// â”€â”€ SUBSCRIBE â”€â”€
function subscribeRoom(code){
  if(unsub)unsub();
  unsub=FB.onValue(dbRef('rooms/'+code),snap=>{
    const room=snap.val();if(!room)return;
    const cs=curScreen();
    if(cs==='lobby-screen')renderLobby(room);
    else if(cs==='game-screen')syncGame(room);
    if(room.phase!=='waiting'&&cs==='lobby-screen')enterGame(room);
    if(room.phase==='results'&&cs==='game-screen')showResults(room);
  });
}

// â”€â”€ LOBBY â”€â”€
function enterLobby(room){
  showScreen('lobby-screen');
  document.getElementById('lcode').textContent=room.code;
  document.getElementById('lcaselbl').textContent='âš–ï¸ '+CASES[room.caseIdx].title;
  if(isHost){document.getElementById('hctrl').style.display='flex';document.getElementById('gctrl').style.display='none';}
  renderLobby(room);
}

function renderLobby(room){
  const players=Object.values(room.players||{});
  const c=document.getElementById('lplayers');c.innerHTML='';
  players.forEach(p=>{
    const rc=ROLES[p.role]||ROLES.jury;
    const d=document.createElement('div');
    d.className='pcard'+(p.isHost?' hst':'')+(p.ready?' rdy':'')+(p.id===myId?' me':'');
    d.innerHTML=`<span class="pcav">${p.avatar}</span><div class="pcn">${p.name}${p.isHost?' ğŸ‘‘':''}</div><div class="pcr r${p.role.charAt(0)}">${rc.icon} ${rc.name}</div>${p.ready?'<div style="color:#2ecc71;font-size:10px;margin-top:3px;">âœ… Ø¬Ø§Ù‡Ø²</div>':''}`;
    c.appendChild(d);
  });
  if(isHost){
    const cnt=players.length;const rdy=players.filter(p=>p.ready||p.isHost).length;
    const btn=document.getElementById('sbtn');const msg=document.getElementById('smsg');
    btn.disabled=cnt<3;msg.textContent=cnt<3?`ØªØ­ØªØ§Ø¬ ${3-cnt} Ù„Ø§Ø¹Ø¨ Ø¥Ø¶Ø§ÙÙŠ`:` ${rdy}/${cnt} Ø¬Ø§Ù‡Ø²`;
  }
  const me=(room.players||{})[myId];
  if(me&&!isHost){const rb=document.getElementById('rbtn');rb.className=me.ready?'btn btn-o btn-sm':'btn btn-gr btn-sm';rb.textContent=me.ready?'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ù‚ÙŠØ©':'âœ… Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø²';}
}

async function toggleReady(){
  const room=await dbGet('rooms/'+myRoom);if(!room)return;
  await dbUpd('rooms/'+myRoom+'/players/'+myId,{ready:!room.players[myId].ready});
}

function copyCode(){navigator.clipboard.writeText(myRoom).catch(()=>{});toast('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯: '+myRoom,'ok');}

// â”€â”€ START GAME â”€â”€
async function startGame(){
  const room=await dbGet('rooms/'+myRoom);if(!room)return;
  const players=Object.values(room.players||{});
  if(players.length<3){toast('ØªØ­ØªØ§Ø¬ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„','err');return;}
  const upd={};
  players.forEach((p,i)=>{upd['rooms/'+myRoom+'/players/'+p.id+'/role']=RORDER[Math.min(i,RORDER.length-1)];});
  upd['rooms/'+myRoom+'/phase']='case_review';upd['rooms/'+myRoom+'/phaseIdx']=1;upd['rooms/'+myRoom+'/phaseStart']=Date.now();
  await dbUpd('/',upd);
  await dbPush('rooms/'+myRoom+'/chat',{system:true,text:'ğŸ¬ Ø¨Ø¯Ø£Øª Ø§Ù„Ø¬Ù„Ø³Ø©! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±',ts:Date.now()});
}

// â”€â”€ ENTER GAME â”€â”€
function enterGame(room){
  showScreen('game-screen');
  const me=(room.players||{})[myId];if(!me)return;
  const rc=ROLES[me.role]||ROLES.jury;
  document.getElementById('mrico').textContent=rc.icon;document.getElementById('mrn').textContent=rc.name;
  document.getElementById('mrico').style.color=rc.color;
  if(isHost)document.getElementById('habtn').style.display='block';
  syncGame(room);
}

// â”€â”€ SYNC GAME â”€â”€
function syncGame(room){
  if(!room)return;
  const me=(room.players||{})[myId];if(!me)return;
  const cd=CASES[room.caseIdx];
  document.getElementById('plbl').textContent=PNAMES[room.phase]||room.phase;
  document.getElementById('pslbl').textContent=PDESCS[room.phase]||'';
  document.getElementById('gcnum').textContent='Ø§Ù„Ù‚Ø¶ÙŠØ© #'+String(room.caseIdx+1).padStart(3,'0');
  document.getElementById('gctitle').textContent=cd.title;
  document.getElementById('gcdesc').textContent=cd.description;
  renderSus(cd,me.role);renderEv(cd,me.role);renderGPL(room,me);renderGSc(room);renderChat(room.chat||{});updateTimer(room);
  ['psiq','psarg','psvote'].forEach(id=>document.getElementById(id).classList.remove('on'));
  if(room.phase==='interrogation'){document.getElementById('psiq').classList.add('on');renderIq(room,me,cd);}
  else if(room.phase==='arguments'){document.getElementById('psarg').classList.add('on');renderArgs(room,me);}
  else if(room.phase==='voting'){document.getElementById('psvote').classList.add('on');renderVote(room,me);}
  if(isHost){
    const ph=PHASES.find(p=>p.id===room.phase);
    if(ph&&ph.dur>0&&room.phaseStart&&(Date.now()-room.phaseStart)/1000>ph.dur+3)advancePhase();
    if(room.phase==='voting'){const j=Object.values(room.players||{}).filter(p=>p.role==='jury');if(j.length>0&&Object.keys(room.votes||{}).length>=j.length)advancePhase();}
  }
}

function renderSus(cd,role){
  const c=document.getElementById('gsus');c.innerHTML='';const sm=['judge','prosecutor','investigator'].includes(role);
  cd.suspects.forEach(s=>{const d=document.createElement('div');d.className='scard';d.innerHTML=`<span class="sav">${s.avatar}</span><div class="sn">${s.name}</div><div class="sr2">${s.role}</div>${sm?`<div class="sm">Ø§Ù„Ø¯Ø§ÙØ¹: ${s.motive}</div>`:''}`;c.appendChild(d);});
}

function renderEv(cd,role){
  const c=document.getElementById('gev');c.innerHTML='';
  cd.evidence.forEach(ev=>{
    const can=ev.rv.includes(role);const d=document.createElement('div');d.className='ecard'+(can?'':' lk');
    if(can){d.innerHTML=`<div class="eico">${ev.type}</div><div class="enm">${ev.name}</div><div class="edc">${ev.desc}</div>`;d.onclick=()=>{document.getElementById('evmc').innerHTML=`<div style="text-align:center;font-size:50px;margin-bottom:11px;">${ev.type}</div><div class="mtitle">${ev.name}</div><p style="color:var(--td);line-height:1.8;font-size:14px;">${ev.desc}</p>`;openModal('evmo');};}
    else d.innerHTML=`<div class="eico">ğŸ”’</div><div class="enm">Ø¯Ù„ÙŠÙ„ Ù…Ù‚ÙŠÙ‘Ø¯</div><div class="edc">ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ø¯ÙˆØ±Ùƒ</div>`;
    c.appendChild(d);
  });
}

function renderGPL(room,me){
  const c=document.getElementById('gpl');c.innerHTML='';
  Object.values(room.players||{}).forEach(p=>{const rc=ROLES[p.role]||ROLES.jury;const d=document.createElement('div');d.className='spitem';d.innerHTML=`<span class="spav">${p.avatar}</span><div class="spi"><div class="spn" style="color:${p.id===myId?'var(--g)':'inherit'}">${p.name}${p.id===myId?' â­':''}</div><div class="spr" style="color:${rc.color}">${rc.icon} ${rc.name}</div></div><div class="sps">${p.score}</div>`;c.appendChild(d);});
}

function renderGSc(room){
  const c=document.getElementById('gscores');c.innerHTML='';
  Object.values(room.players||{}).sort((a,b)=>b.score-a.score).slice(0,5).forEach((p,i)=>{const d=document.createElement('div');d.style.cssText='display:flex;justify-content:space-between;align-items:center;padding:4px 8px;background:var(--d4);border-radius:4px;margin-bottom:4px;font-size:11px;';d.innerHTML=`<span>${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]||i+1+'.'} ${p.name}</span><span style="color:var(--g);font-weight:700;">${p.score}</span>`;c.appendChild(d);});
}

function renderChat(msgs){
  const arr=Array.isArray(msgs)?msgs:Object.values(msgs||{});
  if(arr.length===lastCL)return;lastCL=arr.length;
  const c=document.getElementById('gchat');c.innerHTML='';
  arr.slice(-60).forEach(m=>{const d=document.createElement('div');d.className='cmsg'+(m.system?' sys':'');
    if(m.system)d.innerHTML=`<div class="ct">${m.text}</div>`;
    else{const rc=ROLES[m.role]||ROLES.jury;d.innerHTML=`<div class="ch"><span style="color:${rc.color};font-size:13px;">${rc.icon}</span><span class="cn" style="color:${rc.color}">${m.sender}</span><span style="color:var(--td);font-size:10px;">${m.time||''}</span></div><div class="ct">${m.text}</div>`;}
    c.appendChild(d);});
  c.scrollTop=c.scrollHeight;
}

async function sendChat(){
  const inp=document.getElementById('chatinp');const text=inp.value.trim();if(!text)return;
  const room=await dbGet('rooms/'+myRoom);if(!room)return;const me=room.players[myId];
  await dbPush('rooms/'+myRoom+'/chat',{sender:me.name,role:me.role,text,time:nowTime(),ts:Date.now()});
  inp.value='';
}

function renderIq(room,me,cd){
  const rc=ROLES[me.role]||ROLES.jury;
  const ask=document.getElementById('askarea');
  if(rc.canAsk){ask.style.display='block';const sel=document.getElementById('qtgt');sel.innerHTML='';cd.suspects.forEach(s=>{const o=document.createElement('option');o.value='sus_'+s.id;o.textContent=s.name+' ('+s.role+')';sel.appendChild(o);});Object.values(room.players||{}).filter(p=>p.id!==myId&&['witness','investigator'].includes(p.role)).forEach(p=>{const o=document.createElement('option');o.value='pl_'+p.id;o.textContent=p.name+' â€“ '+(ROLES[p.role]||ROLES.jury).name;sel.appendChild(o);});}
  else ask.style.display='none';
  const ans=document.getElementById('ansarea');
  const qs=toArr(room.questions);
  if(rc.canAns){const uq=qs.filter(q=>q.targetId===myId&&!q.answer);if(uq.length>0){ans.style.display='block';ans.innerHTML=`<div class="panel cact"><div class="ptitle" style="color:#2ecc71;">â“ Ø£Ø³Ø¦Ù„Ø© ØªÙ†ØªØ¸Ø± Ø¥Ø¬Ø§Ø¨ØªÙƒ</div>${uq.map(q=>`<div style="margin-bottom:11px;"><div style="font-size:11px;color:var(--td);margin-bottom:4px;">Ù…Ù† ${q.askerName}:</div><div style="font-weight:700;margin-bottom:6px;">${q.text}</div><input class="inp" id="ai-${q.id}" placeholder="Ø¥Ø¬Ø§Ø¨ØªÙƒ..."><button class="btn btn-gr btn-sm" style="margin-top:7px;" onclick="ansQ('${q.id}')">Ø£Ø¬Ø¨ â†</button></div>`).join('<hr style="border-color:rgba(201,168,76,.1);margin:9px 0;">')}</div>`;}else ans.style.display='none';}
  else ans.style.display='none';
  const ql=document.getElementById('qlist');ql.innerHTML='';
  if(qs.length===0){ql.innerHTML='<p style="color:var(--td);text-align:center;padding:16px;font-size:13px;">Ù„Ù… ØªÙØ·Ø±Ø­ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯...</p>';return;}
  [...qs].reverse().forEach(q=>{const d=document.createElement('div');d.className='qitem';d.innerHTML=`<div class="qhd"><span class="qak">${q.askerName}</span><span class="qtg">â† ${q.targetName}</span></div><div class="qtxt">${q.text}</div>${q.answer?`<div class="qans">ğŸ’¬ ${q.answer}</div>`:`<div class="qpend">âŒ› ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©...</div>`}`;ql.appendChild(d);});
}

async function submitQ(){
  const text=document.getElementById('qtxt').value.trim();if(!text){toast('Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ø§Ù‹','err');return;}
  const room=await dbGet('rooms/'+myRoom);if(!room)return;
  const me=room.players[myId];const cd=CASES[room.caseIdx];
  const tv=document.getElementById('qtgt').value;
  let tname='',tid='';
  if(tv.startsWith('sus_')){const sid=parseInt(tv.replace('sus_',''));const s=cd.suspects.find(s=>s.id===sid);tname=s?s.name:'ØŸ';tid='sus_'+sid;}
  else{const pid=tv.replace('pl_','');const p=room.players[pid];tname=p?p.name:'ØŸ';tid=pid;}
  const q={id:uid(),askerName:me.name,askerId:myId,targetName:tname,targetId:tid,text,answer:null,ts:Date.now()};
  await dbPush('rooms/'+myRoom+'/questions',q);
  await dbUpd('rooms/'+myRoom+'/players/'+myId,{score:(me.score||0)+5});
  document.getElementById('qtxt').value='';toast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„','ok');
  if(tid.startsWith('sus_')){const sid=parseInt(tid.replace('sus_',''));setTimeout(()=>autoAns(q.id,cd.suspects.find(s=>s.id===sid)),2000);}
}

async function autoAns(qId,sus){
  const room=await dbGet('rooms/'+myRoom);if(!room)return;
  const entry=Object.entries(room.questions||{}).find(([k,v])=>v.id===qId);
  if(!entry||entry[1].answer)return;
  const answers=['Ù„Ù… Ø£ÙƒÙ† Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…ÙƒØ§Ù† ØªÙ„Ùƒ Ø§Ù„Ù„ÙŠÙ„Ø©.','Ù‡Ø°Ø§ Ø§ØªÙ‡Ø§Ù… Ø¨Ø§Ø·Ù„ØŒ Ø£Ù†Ø§ Ø¨Ø±ÙŠØ¡ ØªÙ…Ø§Ù…Ø§Ù‹.','Ù„Ø§ Ø£Ø¹Ø±Ù Ù…Ù† ÙŠØ­Ø§ÙˆÙ„ ØªÙ„ÙÙŠÙ‚ Ø§Ù„ØªÙ‡Ù…Ø© Ù„ÙŠ.','ÙƒÙ†Øª ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø¹ Ø¹Ø§Ø¦Ù„ØªÙŠ.','Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‘ Ø£ÙŠ Ø³Ø¨Ø¨ Ù„ÙØ¹Ù„ Ø°Ù„Ùƒ.'];
  await dbUpd('rooms/'+myRoom+'/questions/'+entry[0],{answer:answers[Math.floor(Math.random()*answers.length)]});
}

async function ansQ(qId){
  const inp=document.getElementById('ai-'+qId);if(!inp)return;
  const text=inp.value.trim();if(!text){toast('Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨Ø©','err');return;}
  const room=await dbGet('rooms/'+myRoom);if(!room)return;
  const me=room.players[myId];
  const entry=Object.entries(room.questions||{}).find(([k,v])=>v.id===qId);
  if(!entry)return;
  await dbUpd('rooms/'+myRoom+'/questions/'+entry[0],{answer:text});
  await dbUpd('rooms/'+myRoom+'/players/'+myId,{score:(me.score||0)+10});
  toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø¨ØªÙƒ','ok');
}

function renderArgs(room,me){
  const rc=ROLES[me.role]||ROLES.jury;
  const args=toArr(room.arguments);const myArg=args.find(a=>a.playerId===myId);
  document.getElementById('arginput').style.display=(rc.canArg&&!myArg)?'block':'none';
  const l=document.getElementById('argslist');l.innerHTML='';
  if(!args.length){l.innerHTML='<p style="color:var(--td);text-align:center;padding:16px;font-size:13px;">Ù„Ù… ØªÙÙ‚Ø¯ÙÙ‘Ù… Ù…Ø±Ø§ÙØ¹Ø§Øª Ø¨Ø¹Ø¯...</p>';return;}
  args.forEach(a=>{const p=room.players[a.playerId];if(!p)return;const rc2=ROLES[p.role]||ROLES.jury;const d=document.createElement('div');d.className='aitem';d.innerHTML=`<div style="display:flex;gap:6px;align-items:center;margin-bottom:7px;"><span style="color:${rc2.color};font-size:17px;">${rc2.icon}</span><strong>${p.name}</strong><span style="color:var(--td);font-size:11px;">${rc2.name}</span></div><p style="color:var(--td);font-size:13px;line-height:1.8;">${a.text}</p>`;l.appendChild(d);});
}

async function submitArg(){
  const text=document.getElementById('argtxt').value.trim();if(text.length<20){toast('Ø§ÙƒØªØ¨ Ø£ÙƒØ«Ø± Ù…Ù† 20 Ø­Ø±ÙØ§Ù‹','err');return;}
  const room=await dbGet('rooms/'+myRoom);if(!room)return;const me=room.players[myId];
  await dbPush('rooms/'+myRoom+'/arguments',{id:uid(),playerId:myId,text,ts:Date.now()});
  await dbUpd('rooms/'+myRoom+'/players/'+myId,{score:(me.score||0)+20});
  document.getElementById('argtxt').value='';toast('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ù…Ø±Ø§ÙØ¹ØªÙƒ','ok');
}

function renderVote(room,me){
  const rc=ROLES[me.role]||ROLES.jury;const myV=(room.votes||{})[myId];
  document.getElementById('vopts').style.display=(rc.canVote&&!myV)?'grid':'none';
  const v=room.votes||{};const g=Object.values(v).filter(x=>x==='guilty').length;const n=Object.values(v).filter(x=>x==='innocent').length;
  const j=Object.values(room.players||{}).filter(p=>p.role==='jury').length;
  document.getElementById('vcntlbl').textContent=`Ø§Ù„Ø£ØµÙˆØ§Øª: ${g+n}/${j} â€” Ù…Ø°Ù†Ø¨: ${g} | Ø¨Ø±ÙŠØ¡: ${n}`;
  if(myV)document.getElementById('vstmsg').innerHTML=`<span style="color:${myV==='guilty'?'#e74c3c':'#2ecc71'}">ØµÙˆÙ‘ØªØª Ø¨Ù€: ${myV==='guilty'?'âš–ï¸ Ù…Ø°Ù†Ø¨':'ğŸ•Šï¸ Ø¨Ø±ÙŠØ¡'}</span>`;
}

async function castVote(v){
  const room=await dbGet('rooms/'+myRoom);if(!room)return;const me=room.players[myId];
  if(me.role!=='jury'){toast('ÙÙ‚Ø· Ø§Ù„Ù…Ø­Ù„ÙÙˆÙ† ÙŠØµÙˆÙ‘ØªÙˆÙ†','err');return;}
  if((room.votes||{})[myId]){toast('Ù„Ù‚Ø¯ ØµÙˆÙ‘ØªØª','err');return;}
  await dbUpd('rooms/'+myRoom+'/votes',{[myId]:v});
  await dbUpd('rooms/'+myRoom+'/players/'+myId,{score:(me.score||0)+10});
  toast(`ØµÙˆÙ‘ØªØª Ø¨Ù€: ${v==='guilty'?'âš–ï¸ Ù…Ø°Ù†Ø¨':'ğŸ•Šï¸ Ø¨Ø±ÙŠØ¡'}`,'ok');
}

function updateTimer(room){
  const ph=PHASES.find(p=>p.id===room.phase);const el=document.getElementById('gtimer');
  if(!ph||!ph.dur||!room.phaseStart){el.textContent='--:--';el.classList.remove('warn');return;}
  const rem=Math.max(0,ph.dur-Math.floor((Date.now()-room.phaseStart)/1000));
  el.textContent=`${String(Math.floor(rem/60)).padStart(2,'0')}:${String(rem%60).padStart(2,'0')}`;
  el.classList.toggle('warn',rem<=30&&S.timerWarn);
}
setInterval(async()=>{if(curScreen()==='game-screen'&&myRoom){const r=await dbGet('rooms/'+myRoom);if(r)updateTimer(r);}},1000);

async function advancePhase(){
  if(!isHost)return;const room=await dbGet('rooms/'+myRoom);if(!room)return;
  const phases=['waiting','case_review','interrogation','arguments','voting','results'];
  const ci=phases.indexOf(room.phase);if(ci<0||ci>=phases.length-1)return;
  const next=phases[ci+1];
  await dbUpd('rooms/'+myRoom,{phase:next,phaseIdx:ci+1,phaseStart:Date.now()});
  await dbPush('rooms/'+myRoom+'/chat',{system:true,text:'âš–ï¸ Ø§Ù†ØªÙ‚Ù„Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¥Ù„Ù‰: '+(PNAMES[next]||next),ts:Date.now()});
}

async function showResults(room){
  if(!room)room=await dbGet('rooms/'+myRoom);
  showScreen('results-screen');
  const cd=CASES[room.caseIdx];const v=room.votes||{};
  const g=Object.values(v).filter(x=>x==='guilty').length;const n=Object.values(v).filter(x=>x==='innocent').length;
  const verdict=g>n?'guilty':'innocent';const culp=cd.suspects.find(s=>s.isCulprit);const ok=verdict==='guilty';
  const ve=document.getElementById('rverd');ve.style.display='block';ve.className=`verdict ${verdict==='guilty'?'vg':'vi'}`;ve.textContent=verdict==='guilty'?'âš–ï¸ Ø§Ù„Ø­ÙƒÙ…: Ù…Ø°Ù†Ø¨':'ğŸ•Šï¸ Ø§Ù„Ø­ÙƒÙ…: Ø¨Ø±ÙŠØ¡';
  document.getElementById('rtruth').innerHTML=`<strong>Ø§Ù„Ù…Ø¬Ø±Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ:</strong> ${culp?culp.name:'ØŸ'} (${culp?culp.role:''}) â€” <span style="color:${ok?'#2ecc71':'#e74c3c'}">${ok?'âœ… Ø§Ù„Ø­ÙƒÙ… ØµØ­ÙŠØ­!':'âŒ Ø§Ù„Ø­ÙƒÙ… Ø®Ø§Ø·Ø¦!'}</span>`;
  const players=Object.values(room.players||{}).map(p=>{let s=p.score||0;if(p.role==='jury'&&v[p.id]===verdict)s+=30;if(['prosecutor','defender'].includes(p.role))s+=15;return{...p,score:s};}).sort((a,b)=>b.score-a.score);
  const tbl=document.getElementById('rscores');const hdr=tbl.rows[0];tbl.innerHTML='';tbl.appendChild(hdr);
  players.forEach((p,i)=>{const rc=ROLES[p.role]||ROLES.jury;const tr=document.createElement('tr');tr.innerHTML=`<td>${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]||(i+1)}</td><td>${p.avatar} ${p.name}${p.id===myId?' â­':''}</td><td style="color:${rc.color}">${rc.icon} ${rc.name}</td><td><strong>${p.score}</strong></td>`;tbl.appendChild(tr);});
  const best=players[0];const mqp=players.reduce((a,b)=>toArr(room.questions).filter(q=>q.askerId===b.id).length>toArr(room.questions).filter(q=>q.askerId===a.id).length?b:a,players[0]);const bl=players.find(p=>['prosecutor','defender'].includes(p.role));
  document.getElementById('rawards').innerHTML=`<div class="awd"><div class="aico">ğŸ‘‘</div><div class="albl" style="color:var(--g)">Ø¨Ø·Ù„ Ø§Ù„Ù‚Ø¶ÙŠØ©</div><div class="awn">${best?.name||'-'}</div></div><div class="awd"><div class="aico">ğŸ§ </div><div class="albl" style="color:#3498db">Ø£Ø°ÙƒÙ‰ Ù…Ø­Ù„Ù„</div><div class="awn">${mqp?.name||'-'}</div></div><div class="awd"><div class="aico">âš–ï¸</div><div class="albl" style="color:#9b59b6">Ø£ÙØ¶Ù„ Ù…Ø­Ø§Ù…Ù</div><div class="awn">${bl?.name||'-'}</div></div>`;
}

async function leaveRoom(){
  if(myRoom&&myId)await dbUpd('rooms/'+myRoom+'/players/'+myId,{left:true}).catch(()=>{});
  reset();goHome();
}
function playAgain(){reset();goHome();}
function goHome(){reset();showScreen('home-screen');}
function reset(){myId=null;myRoom=null;isHost=false;lastCL=0;if(unsub){unsub();unsub=null;}}

// â”€â”€ INIT â”€â”€
loadSUI();
document.querySelectorAll('.mo').forEach(m=>{m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('show');});});
document.getElementById('jc').addEventListener('input',function(){this.value=this.value.toUpperCase();});
</script>
</body>
</html>
